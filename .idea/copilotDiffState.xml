<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/Backend/admin-service/src/main/java/com/cibf/adminservice/admin/Service/ConfigurationService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Backend/admin-service/src/main/java/com/cibf/adminservice/admin/Service/ConfigurationService.java" />
              <option name="originalContent" value="package com.cibf.adminservice.admin.Service;&#10;&#10;import com.cibf.adminservice.admin.Common.ActionStatus;&#10;import com.cibf.adminservice.admin.Common.AlertSeverity;&#10;import com.cibf.adminservice.admin.Common.ConfigValueType;&#10;import com.cibf.adminservice.admin.Common.LogAction;&#10;import com.cibf.adminservice.admin.DTO.Request.UpdateConfigurationRequestDTO;&#10;import com.cibf.adminservice.admin.DTO.Response.ConfigurationResponseDTO;&#10;import com.cibf.adminservice.admin.Entity.ConfigurationSetting;&#10;import com.cibf.adminservice.admin.Exception.BadRequestException;&#10;import com.cibf.adminservice.admin.Exception.ResourceNotFoundException;&#10;import com.cibf.adminservice.admin.Repository.ConfigurationSettingRepository;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.List;&#10;import java.util.UUID;&#10;import java.util.stream.Collectors;&#10;&#10;/**&#10; * Service for managing system configuration settings&#10; * Provides CRUD operations for configuration key-value pairs&#10; */&#10;@Service&#10;@Slf4j&#10;@RequiredArgsConstructor&#10;public class ConfigurationService {&#10;&#10;    private final ConfigurationSettingRepository configurationSettingRepository;&#10;    private final AuditLogService auditLogService;&#10;&#10;    /**&#10;     * Get all configuration settings&#10;     */&#10;    public List&lt;ConfigurationResponseDTO&gt; getAllConfigurations() {&#10;        log.info(&quot;Fetching all configuration settings&quot;);&#10;        &#10;        List&lt;ConfigurationSetting&gt; settings = configurationSettingRepository.findAll();&#10;        log.info(&quot;Found {} configuration settings&quot;, settings.size());&#10;&#10;        return settings.stream()&#10;                .map(this::mapToResponseDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    /**&#10;     * Get configuration by ID&#10;     */&#10;    public ConfigurationResponseDTO getConfigurationById(Long configId) {&#10;        log.info(&quot;Fetching configuration by ID: {}&quot;, configId);&#10;        &#10;        ConfigurationSetting setting = configurationSettingRepository.findById(configId)&#10;                .orElseThrow(() -&gt; {&#10;                    log.warn(&quot;Configuration not found: {}&quot;, configId);&#10;                    return new ResourceNotFoundException(&quot;Configuration setting not found&quot;);&#10;                });&#10;&#10;        return mapToResponseDTO(setting);&#10;    }&#10;&#10;    /**&#10;     * Get configuration by key&#10;     */&#10;    public ConfigurationResponseDTO getConfigurationByKey(String configKey) {&#10;        log.info(&quot;Fetching configuration by key: {}&quot;, configKey);&#10;        &#10;        ConfigurationSetting setting = configurationSettingRepository.findByConfigKey(configKey)&#10;                .orElseThrow(() -&gt; {&#10;                    log.warn(&quot;Configuration not found for key: {}&quot;, configKey);&#10;                    return new ResourceNotFoundException(&quot;Configuration setting not found&quot;);&#10;                });&#10;&#10;        return mapToResponseDTO(setting);&#10;    }&#10;&#10;    /**&#10;     * Get configuration value by key (returns raw value)&#10;     */&#10;    public String getConfigurationValue(String configKey) {&#10;        log.debug(&quot;Getting configuration value for key: {}&quot;, configKey);&#10;        &#10;        ConfigurationSetting setting = configurationSettingRepository.findByConfigKey(configKey)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        return setting.getConfigValue();&#10;    }&#10;&#10;    /**&#10;     * Get configurations by category&#10;     */&#10;    public List&lt;ConfigurationResponseDTO&gt; getConfigurationsByCategory(String category) {&#10;        log.info(&quot;Fetching configurations by category: {}&quot;, category);&#10;        &#10;        List&lt;ConfigurationSetting&gt; settings = configurationSettingRepository.findByCategory(category);&#10;        log.info(&quot;Found {} configuration settings in category {}&quot;, settings.size(), category);&#10;&#10;        return settings.stream()&#10;                .map(this::mapToResponseDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    /**&#10;     * Get editable configurations&#10;     */&#10;    public List&lt;ConfigurationResponseDTO&gt; getEditableConfigurations() {&#10;        log.info(&quot;Fetching editable configuration settings&quot;);&#10;        &#10;        List&lt;ConfigurationSetting&gt; settings = configurationSettingRepository.findByIsEditable(true);&#10;        log.info(&quot;Found {} editable configuration settings&quot;, settings.size());&#10;&#10;        return settings.stream()&#10;                .map(this::mapToResponseDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    /**&#10;     * Create new configuration setting&#10;     */&#10;    @Transactional&#10;    public ConfigurationResponseDTO createConfiguration(&#10;            String configKey,&#10;            String configValue,&#10;            ConfigValueType valueType,&#10;            String category,&#10;            String description,&#10;            Boolean isEditable,&#10;            UUID createdBy&#10;    ) {&#10;        log.info(&quot;Creating new configuration: {}&quot;, configKey);&#10;&#10;        // Check if key already exists&#10;        if (configurationSettingRepository.existsByConfigKey(configKey)) {&#10;            log.warn(&quot;Configuration key already exists: {}&quot;, configKey);&#10;            throw new BadRequestException(&quot;Configuration key already exists&quot;);&#10;        }&#10;&#10;        // Validate value type&#10;        validateConfigValue(configValue, valueType);&#10;&#10;        // Create configuration setting&#10;        ConfigurationSetting setting = new ConfigurationSetting();&#10;        setting.setConfigKey(configKey);&#10;        setting.setConfigValue(configValue);&#10;        setting.setValueType(valueType);&#10;        setting.setCategory(category);&#10;        setting.setDescription(description);&#10;        setting.setIsEncrypted(false);&#10;        setting.setIsEditable(isEditable != null ? isEditable : true);&#10;        setting.setLastModifiedBy(createdBy);&#10;&#10;        ConfigurationSetting savedSetting = configurationSettingRepository.save(setting);&#10;        log.info(&quot;Configuration created successfully: {} = {}&quot;, configKey, configValue);&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                createdBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                savedSetting.getConfigId().toString(),&#10;                String.format(&quot;Configuration created: %s = %s&quot;, configKey, configValue),&#10;                (String) null,&#10;                (String) null,&#10;                AlertSeverity.MEDIUM,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;&#10;        return mapToResponseDTO(savedSetting);&#10;    }&#10;&#10;    /**&#10;     * Update configuration setting&#10;     */&#10;    @Transactional&#10;    public ConfigurationResponseDTO updateConfiguration(&#10;            Long configId,&#10;            UpdateConfigurationRequestDTO requestDTO,&#10;            UUID modifiedBy&#10;    ) {&#10;        log.info(&quot;Updating configuration: {}&quot;, configId);&#10;&#10;        ConfigurationSetting setting = configurationSettingRepository.findById(configId)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        // Check if configuration is editable&#10;        if (!setting.getIsEditable()) {&#10;            log.warn(&quot;Attempt to update non-editable configuration: {}&quot;, configId);&#10;            throw new BadRequestException(&quot;This configuration setting is not editable&quot;);&#10;        }&#10;&#10;        String oldValue = setting.getConfigValue();&#10;&#10;        // Validate new value if provided&#10;        if (requestDTO.getConfigValue() != null) {&#10;            validateConfigValue(requestDTO.getConfigValue(), setting.getValueType());&#10;            setting.setConfigValue(requestDTO.getConfigValue());&#10;        }&#10;&#10;        if (requestDTO.getDescription() != null) {&#10;            setting.setDescription(requestDTO.getDescription());&#10;        }&#10;&#10;        setting.setLastModifiedBy(modifiedBy);&#10;&#10;        ConfigurationSetting updatedSetting = configurationSettingRepository.save(setting);&#10;        log.info(&quot;Configuration updated successfully: {} = {}&quot;, setting.getConfigKey(), setting.getConfigValue());&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                modifiedBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                configId.toString(),&#10;                String.format(&quot;Configuration updated: %s&quot;, setting.getConfigKey()),&#10;                (String) null,&#10;                oldValue,&#10;                AlertSeverity.MEDIUM,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;&#10;        return mapToResponseDTO(updatedSetting);&#10;    }&#10;&#10;    /**&#10;     * Update configuration value by key&#10;     */&#10;    @Transactional&#10;    public ConfigurationResponseDTO updateConfigurationByKey(&#10;            String configKey,&#10;            String newValue,&#10;            UUID modifiedBy&#10;    ) {&#10;        log.info(&quot;Updating configuration by key: {}&quot;, configKey);&#10;&#10;        ConfigurationSetting setting = configurationSettingRepository.findByConfigKey(configKey)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        // Check if configuration is editable&#10;        if (!setting.getIsEditable()) {&#10;            throw new BadRequestException(&quot;This configuration setting is not editable&quot;);&#10;        }&#10;&#10;        String oldValue = setting.getConfigValue();&#10;&#10;        // Validate new value&#10;        validateConfigValue(newValue, setting.getValueType());&#10;        setting.setConfigValue(newValue);&#10;        setting.setLastModifiedBy(modifiedBy);&#10;&#10;        ConfigurationSetting updatedSetting = configurationSettingRepository.save(setting);&#10;        log.info(&quot;Configuration updated successfully: {} = {}&quot;, configKey, newValue);&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                modifiedBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                setting.getConfigId().toString(),&#10;                String.format(&quot;Configuration updated: %s = %s&quot;, configKey, newValue),&#10;                (String) null,&#10;                oldValue,&#10;                AlertSeverity.MEDIUM,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;&#10;        return mapToResponseDTO(updatedSetting);&#10;    }&#10;&#10;    /**&#10;     * Delete configuration setting&#10;     */&#10;    @Transactional&#10;    public void deleteConfiguration(Long configId, UUID deletedBy) {&#10;        log.info(&quot;Deleting configuration: {}&quot;, configId);&#10;&#10;        ConfigurationSetting setting = configurationSettingRepository.findById(configId)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        // Check if configuration is editable&#10;        if (!setting.getIsEditable()) {&#10;            throw new BadRequestException(&quot;This configuration setting cannot be deleted&quot;);&#10;        }&#10;&#10;        String configKey = setting.getConfigKey();&#10;        configurationSettingRepository.delete(setting);&#10;&#10;        log.info(&quot;Configuration deleted successfully: {}&quot;, configKey);&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                deletedBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                configId.toString(),&#10;                String.format(&quot;Configuration deleted: %s&quot;, configKey),&#10;                null,&#10;                null,&#10;                AlertSeverity.HIGH,&#10;                ActionStatus.SUCCESS,&#10;                null&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Initialize default configurations (for first-time setup)&#10;     */&#10;    @Transactional&#10;    public void initializeDefaultConfigurations(UUID createdBy) {&#10;        log.info(&quot;Initializing default configurations&quot;);&#10;&#10;        // Only initialize if no configurations exist&#10;        if (configurationSettingRepository.count() &gt; 0) {&#10;            log.info(&quot;Configurations already exist. Skipping initialization.&quot;);&#10;            return;&#10;        }&#10;&#10;        // Default configurations&#10;        createDefaultConfig(&quot;app.name&quot;, &quot;CIBF Reservation System&quot;, ConfigValueType.STRING, &quot;Application&quot;, &quot;Application name&quot;, false, createdBy);&#10;        createDefaultConfig(&quot;app.version&quot;, &quot;1.0.0&quot;, ConfigValueType.STRING, &quot;Application&quot;, &quot;Application version&quot;, false, createdBy);&#10;        createDefaultConfig(&quot;max.reservations.per.user&quot;, &quot;5&quot;, ConfigValueType.INTEGER, &quot;Business Rules&quot;, &quot;Maximum reservations per user&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;booking.enabled&quot;, &quot;true&quot;, ConfigValueType.BOOLEAN, &quot;Business Rules&quot;, &quot;Enable/disable booking system&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;maintenance.mode&quot;, &quot;false&quot;, ConfigValueType.BOOLEAN, &quot;System&quot;, &quot;System maintenance mode&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;email.notifications.enabled&quot;, &quot;true&quot;, ConfigValueType.BOOLEAN, &quot;Notifications&quot;, &quot;Enable email notifications&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;sms.notifications.enabled&quot;, &quot;false&quot;, ConfigValueType.BOOLEAN, &quot;Notifications&quot;, &quot;Enable SMS notifications&quot;, true, createdBy);&#10;&#10;        log.info(&quot;Default configurations initialized successfully&quot;);&#10;    }&#10;&#10;    /**&#10;     * Helper method to create default configuration&#10;     */&#10;    private void createDefaultConfig(&#10;            String key,&#10;            String value,&#10;            ConfigValueType type,&#10;            String category,&#10;            String description,&#10;            Boolean isEditable,&#10;            UUID createdBy&#10;    ) {&#10;        ConfigurationSetting setting = new ConfigurationSetting();&#10;        setting.setConfigKey(key);&#10;        setting.setConfigValue(value);&#10;        setting.setValueType(type);&#10;        setting.setCategory(category);&#10;        setting.setDescription(description);&#10;        setting.setIsEncrypted(false);&#10;        setting.setIsEditable(isEditable);&#10;        setting.setLastModifiedBy(createdBy);&#10;        configurationSettingRepository.save(setting);&#10;    }&#10;&#10;    /**&#10;     * Validate configuration value based on type&#10;     */&#10;    private void validateConfigValue(String value, ConfigValueType valueType) {&#10;        try {&#10;            switch (valueType) {&#10;                case INTEGER:&#10;                    Integer.parseInt(value);&#10;                    break;&#10;                case DECIMAL:&#10;                    Double.parseDouble(value);&#10;                    break;&#10;                case BOOLEAN:&#10;                    if (!value.equalsIgnoreCase(&quot;true&quot;) &amp;&amp; !value.equalsIgnoreCase(&quot;false&quot;)) {&#10;                        throw new BadRequestException(&quot;Boolean value must be 'true' or 'false'&quot;);&#10;                    }&#10;                    break;&#10;                case JSON:&#10;                    // Basic JSON validation (can be enhanced)&#10;                    if (!value.trim().startsWith(&quot;{&quot;) &amp;&amp; !value.trim().startsWith(&quot;[&quot;)) {&#10;                        throw new BadRequestException(&quot;Invalid JSON format&quot;);&#10;                    }&#10;                    break;&#10;                case STRING:&#10;                    // No specific validation needed&#10;                    break;&#10;                default:&#10;                    throw new BadRequestException(&quot;Unknown value type&quot;);&#10;            }&#10;        } catch (NumberFormatException e) {&#10;            throw new BadRequestException(&quot;Invalid value format for type: &quot; + valueType);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Map entity to response DTO&#10;     */&#10;    private ConfigurationResponseDTO mapToResponseDTO(ConfigurationSetting setting) {&#10;        ConfigurationResponseDTO dto = new ConfigurationResponseDTO();&#10;        dto.setConfigId(setting.getConfigId());&#10;        dto.setConfigKey(setting.getConfigKey());&#10;        dto.setConfigValue(setting.getConfigValue());&#10;        dto.setValueType(setting.getValueType().name());&#10;        dto.setDescription(setting.getDescription());&#10;        dto.setIsEditable(setting.getIsEditable());&#10;        return dto;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.cibf.adminservice.admin.Service;&#10;&#10;import com.cibf.adminservice.admin.Common.ActionStatus;&#10;import com.cibf.adminservice.admin.Common.AlertSeverity;&#10;import com.cibf.adminservice.admin.Common.ConfigValueType;&#10;import com.cibf.adminservice.admin.Common.LogAction;&#10;import com.cibf.adminservice.admin.DTO.Request.UpdateConfigurationRequestDTO;&#10;import com.cibf.adminservice.admin.DTO.Response.ConfigurationResponseDTO;&#10;import com.cibf.adminservice.admin.Entity.ConfigurationSetting;&#10;import com.cibf.adminservice.admin.Exception.BadRequestException;&#10;import com.cibf.adminservice.admin.Exception.ResourceNotFoundException;&#10;import com.cibf.adminservice.admin.Repository.ConfigurationSettingRepository;&#10;import lombok.RequiredArgsConstructor;&#10;import lombok.extern.slf4j.Slf4j;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;&#10;import java.util.List;&#10;import java.util.UUID;&#10;import java.util.stream.Collectors;&#10;&#10;/**&#10; * Service for managing system configuration settings&#10; * Provides CRUD operations for configuration key-value pairs&#10; */&#10;@Service&#10;@Slf4j&#10;@RequiredArgsConstructor&#10;public class ConfigurationService {&#10;&#10;    private final ConfigurationSettingRepository configurationSettingRepository;&#10;    private final AuditLogService auditLogService;&#10;&#10;    /**&#10;     * Get all configuration settings&#10;     */&#10;    public List&lt;ConfigurationResponseDTO&gt; getAllConfigurations() {&#10;        log.info(&quot;Fetching all configuration settings&quot;);&#10;        &#10;        List&lt;ConfigurationSetting&gt; settings = configurationSettingRepository.findAll();&#10;        log.info(&quot;Found {} configuration settings&quot;, settings.size());&#10;&#10;        return settings.stream()&#10;                .map(this::mapToResponseDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    /**&#10;     * Get configuration by ID&#10;     */&#10;    public ConfigurationResponseDTO getConfigurationById(Long configId) {&#10;        log.info(&quot;Fetching configuration by ID: {}&quot;, configId);&#10;        &#10;        ConfigurationSetting setting = configurationSettingRepository.findById(configId)&#10;                .orElseThrow(() -&gt; {&#10;                    log.warn(&quot;Configuration not found: {}&quot;, configId);&#10;                    return new ResourceNotFoundException(&quot;Configuration setting not found&quot;);&#10;                });&#10;&#10;        return mapToResponseDTO(setting);&#10;    }&#10;&#10;    /**&#10;     * Get configuration by key&#10;     */&#10;    public ConfigurationResponseDTO getConfigurationByKey(String configKey) {&#10;        log.info(&quot;Fetching configuration by key: {}&quot;, configKey);&#10;        &#10;        ConfigurationSetting setting = configurationSettingRepository.findByConfigKey(configKey)&#10;                .orElseThrow(() -&gt; {&#10;                    log.warn(&quot;Configuration not found for key: {}&quot;, configKey);&#10;                    return new ResourceNotFoundException(&quot;Configuration setting not found&quot;);&#10;                });&#10;&#10;        return mapToResponseDTO(setting);&#10;    }&#10;&#10;    /**&#10;     * Get configuration value by key (returns raw value)&#10;     */&#10;    public String getConfigurationValue(String configKey) {&#10;        log.debug(&quot;Getting configuration value for key: {}&quot;, configKey);&#10;        &#10;        ConfigurationSetting setting = configurationSettingRepository.findByConfigKey(configKey)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        return setting.getConfigValue();&#10;    }&#10;&#10;    /**&#10;     * Get configurations by category&#10;     */&#10;    public List&lt;ConfigurationResponseDTO&gt; getConfigurationsByCategory(String category) {&#10;        log.info(&quot;Fetching configurations by category: {}&quot;, category);&#10;        &#10;        List&lt;ConfigurationSetting&gt; settings = configurationSettingRepository.findByCategory(category);&#10;        log.info(&quot;Found {} configuration settings in category {}&quot;, settings.size(), category);&#10;&#10;        return settings.stream()&#10;                .map(this::mapToResponseDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    /**&#10;     * Get editable configurations&#10;     */&#10;    public List&lt;ConfigurationResponseDTO&gt; getEditableConfigurations() {&#10;        log.info(&quot;Fetching editable configuration settings&quot;);&#10;        &#10;        List&lt;ConfigurationSetting&gt; settings = configurationSettingRepository.findByIsEditable(true);&#10;        log.info(&quot;Found {} editable configuration settings&quot;, settings.size());&#10;&#10;        return settings.stream()&#10;                .map(this::mapToResponseDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    /**&#10;     * Create new configuration setting&#10;     */&#10;    @Transactional&#10;    public ConfigurationResponseDTO createConfiguration(&#10;            String configKey,&#10;            String configValue,&#10;            ConfigValueType valueType,&#10;            String category,&#10;            String description,&#10;            Boolean isEditable,&#10;            UUID createdBy&#10;    ) {&#10;        log.info(&quot;Creating new configuration: {}&quot;, configKey);&#10;&#10;        // Check if key already exists&#10;        if (configurationSettingRepository.existsByConfigKey(configKey)) {&#10;            log.warn(&quot;Configuration key already exists: {}&quot;, configKey);&#10;            throw new BadRequestException(&quot;Configuration key already exists&quot;);&#10;        }&#10;&#10;        // Validate value type&#10;        validateConfigValue(configValue, valueType);&#10;&#10;        // Create configuration setting&#10;        ConfigurationSetting setting = new ConfigurationSetting();&#10;        setting.setConfigKey(configKey);&#10;        setting.setConfigValue(configValue);&#10;        setting.setValueType(valueType);&#10;        setting.setCategory(category);&#10;        setting.setDescription(description);&#10;        setting.setIsEncrypted(false);&#10;        setting.setIsEditable(isEditable != null ? isEditable : true);&#10;        setting.setLastModifiedBy(createdBy);&#10;&#10;        ConfigurationSetting savedSetting = configurationSettingRepository.save(setting);&#10;        log.info(&quot;Configuration created successfully: {} = {}&quot;, configKey, configValue);&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                createdBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                savedSetting.getConfigId().toString(),&#10;                String.format(&quot;Configuration created: %s = %s&quot;, configKey, configValue),&#10;                (String) null,&#10;                (String) null,&#10;                AlertSeverity.MEDIUM,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;&#10;        return mapToResponseDTO(savedSetting);&#10;    }&#10;&#10;    /**&#10;     * Update configuration setting&#10;     */&#10;    @Transactional&#10;    public ConfigurationResponseDTO updateConfiguration(&#10;            Long configId,&#10;            UpdateConfigurationRequestDTO requestDTO,&#10;            UUID modifiedBy&#10;    ) {&#10;        log.info(&quot;Updating configuration: {}&quot;, configId);&#10;&#10;        ConfigurationSetting setting = configurationSettingRepository.findById(configId)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        // Check if configuration is editable&#10;        if (!setting.getIsEditable()) {&#10;            log.warn(&quot;Attempt to update non-editable configuration: {}&quot;, configId);&#10;            throw new BadRequestException(&quot;This configuration setting is not editable&quot;);&#10;        }&#10;&#10;        String oldValue = setting.getConfigValue();&#10;&#10;        // Validate new value if provided&#10;        if (requestDTO.getConfigValue() != null) {&#10;            validateConfigValue(requestDTO.getConfigValue(), setting.getValueType());&#10;            setting.setConfigValue(requestDTO.getConfigValue());&#10;        }&#10;&#10;        if (requestDTO.getDescription() != null) {&#10;            setting.setDescription(requestDTO.getDescription());&#10;        }&#10;&#10;        setting.setLastModifiedBy(modifiedBy);&#10;&#10;        ConfigurationSetting updatedSetting = configurationSettingRepository.save(setting);&#10;        log.info(&quot;Configuration updated successfully: {} = {}&quot;, setting.getConfigKey(), setting.getConfigValue());&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                modifiedBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                configId.toString(),&#10;                String.format(&quot;Configuration updated: %s&quot;, setting.getConfigKey()),&#10;                (String) null,&#10;                oldValue,&#10;                AlertSeverity.MEDIUM,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;&#10;        return mapToResponseDTO(updatedSetting);&#10;    }&#10;&#10;    /**&#10;     * Update configuration value by key&#10;     */&#10;    @Transactional&#10;    public ConfigurationResponseDTO updateConfigurationByKey(&#10;            String configKey,&#10;            String newValue,&#10;            UUID modifiedBy&#10;    ) {&#10;        log.info(&quot;Updating configuration by key: {}&quot;, configKey);&#10;&#10;        ConfigurationSetting setting = configurationSettingRepository.findByConfigKey(configKey)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        // Check if configuration is editable&#10;        if (!setting.getIsEditable()) {&#10;            throw new BadRequestException(&quot;This configuration setting is not editable&quot;);&#10;        }&#10;&#10;        String oldValue = setting.getConfigValue();&#10;&#10;        // Validate new value&#10;        validateConfigValue(newValue, setting.getValueType());&#10;        setting.setConfigValue(newValue);&#10;        setting.setLastModifiedBy(modifiedBy);&#10;&#10;        ConfigurationSetting updatedSetting = configurationSettingRepository.save(setting);&#10;        log.info(&quot;Configuration updated successfully: {} = {}&quot;, configKey, newValue);&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                modifiedBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                setting.getConfigId().toString(),&#10;                String.format(&quot;Configuration updated: %s = %s&quot;, configKey, newValue),&#10;                (String) null,&#10;                oldValue,&#10;                AlertSeverity.MEDIUM,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;&#10;        return mapToResponseDTO(updatedSetting);&#10;    }&#10;&#10;    /**&#10;     * Delete configuration setting&#10;     */&#10;    @Transactional&#10;    public void deleteConfiguration(Long configId, UUID deletedBy) {&#10;        log.info(&quot;Deleting configuration: {}&quot;, configId);&#10;&#10;        ConfigurationSetting setting = configurationSettingRepository.findById(configId)&#10;                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;Configuration setting not found&quot;));&#10;&#10;        // Check if configuration is editable&#10;        if (!setting.getIsEditable()) {&#10;            throw new BadRequestException(&quot;This configuration setting cannot be deleted&quot;);&#10;        }&#10;&#10;        String configKey = setting.getConfigKey();&#10;        configurationSettingRepository.delete(setting);&#10;&#10;        log.info(&quot;Configuration deleted successfully: {}&quot;, configKey);&#10;&#10;        // Log audit&#10;        auditLogService.logAction(&#10;                deletedBy,&#10;                LogAction.SYSTEM_CONFIG_CHANGED,&#10;                &quot;ConfigurationSetting&quot;,&#10;                configId.toString(),&#10;                String.format(&quot;Configuration deleted: %s&quot;, configKey),&#10;                (String) null,&#10;                (String) null,&#10;                AlertSeverity.HIGH,&#10;                ActionStatus.SUCCESS,&#10;                (String) null&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Initialize default configurations (for first-time setup)&#10;     */&#10;    @Transactional&#10;    public void initializeDefaultConfigurations(UUID createdBy) {&#10;        log.info(&quot;Initializing default configurations&quot;);&#10;&#10;        // Only initialize if no configurations exist&#10;        if (configurationSettingRepository.count() &gt; 0) {&#10;            log.info(&quot;Configurations already exist. Skipping initialization.&quot;);&#10;            return;&#10;        }&#10;&#10;        // Default configurations&#10;        createDefaultConfig(&quot;app.name&quot;, &quot;CIBF Reservation System&quot;, ConfigValueType.STRING, &quot;Application&quot;, &quot;Application name&quot;, false, createdBy);&#10;        createDefaultConfig(&quot;app.version&quot;, &quot;1.0.0&quot;, ConfigValueType.STRING, &quot;Application&quot;, &quot;Application version&quot;, false, createdBy);&#10;        createDefaultConfig(&quot;max.reservations.per.user&quot;, &quot;5&quot;, ConfigValueType.INTEGER, &quot;Business Rules&quot;, &quot;Maximum reservations per user&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;booking.enabled&quot;, &quot;true&quot;, ConfigValueType.BOOLEAN, &quot;Business Rules&quot;, &quot;Enable/disable booking system&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;maintenance.mode&quot;, &quot;false&quot;, ConfigValueType.BOOLEAN, &quot;System&quot;, &quot;System maintenance mode&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;email.notifications.enabled&quot;, &quot;true&quot;, ConfigValueType.BOOLEAN, &quot;Notifications&quot;, &quot;Enable email notifications&quot;, true, createdBy);&#10;        createDefaultConfig(&quot;sms.notifications.enabled&quot;, &quot;false&quot;, ConfigValueType.BOOLEAN, &quot;Notifications&quot;, &quot;Enable SMS notifications&quot;, true, createdBy);&#10;&#10;        log.info(&quot;Default configurations initialized successfully&quot;);&#10;    }&#10;&#10;    /**&#10;     * Helper method to create default configuration&#10;     */&#10;    private void createDefaultConfig(&#10;            String key,&#10;            String value,&#10;            ConfigValueType type,&#10;            String category,&#10;            String description,&#10;            Boolean isEditable,&#10;            UUID createdBy&#10;    ) {&#10;        ConfigurationSetting setting = new ConfigurationSetting();&#10;        setting.setConfigKey(key);&#10;        setting.setConfigValue(value);&#10;        setting.setValueType(type);&#10;        setting.setCategory(category);&#10;        setting.setDescription(description);&#10;        setting.setIsEncrypted(false);&#10;        setting.setIsEditable(isEditable);&#10;        setting.setLastModifiedBy(createdBy);&#10;        configurationSettingRepository.save(setting);&#10;    }&#10;&#10;    /**&#10;     * Validate configuration value based on type&#10;     */&#10;    private void validateConfigValue(String value, ConfigValueType valueType) {&#10;        try {&#10;            switch (valueType) {&#10;                case INTEGER:&#10;                    Integer.parseInt(value);&#10;                    break;&#10;                case DECIMAL:&#10;                    Double.parseDouble(value);&#10;                    break;&#10;                case BOOLEAN:&#10;                    if (!value.equalsIgnoreCase(&quot;true&quot;) &amp;&amp; !value.equalsIgnoreCase(&quot;false&quot;)) {&#10;                        throw new BadRequestException(&quot;Boolean value must be 'true' or 'false'&quot;);&#10;                    }&#10;                    break;&#10;                case JSON:&#10;                    // Basic JSON validation (can be enhanced)&#10;                    if (!value.trim().startsWith(&quot;{&quot;) &amp;&amp; !value.trim().startsWith(&quot;[&quot;)) {&#10;                        throw new BadRequestException(&quot;Invalid JSON format&quot;);&#10;                    }&#10;                    break;&#10;                case STRING:&#10;                    // No specific validation needed&#10;                    break;&#10;                default:&#10;                    throw new BadRequestException(&quot;Unknown value type&quot;);&#10;            }&#10;        } catch (NumberFormatException e) {&#10;            throw new BadRequestException(&quot;Invalid value format for type: &quot; + valueType);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Map entity to response DTO&#10;     */&#10;    private ConfigurationResponseDTO mapToResponseDTO(ConfigurationSetting setting) {&#10;        ConfigurationResponseDTO dto = new ConfigurationResponseDTO();&#10;        dto.setConfigId(setting.getConfigId());&#10;        dto.setConfigKey(setting.getConfigKey());&#10;        dto.setConfigValue(setting.getConfigValue());&#10;        dto.setValueType(setting.getValueType().name());&#10;        dto.setDescription(setting.getDescription());&#10;        dto.setIsEditable(setting.getIsEditable());&#10;        return dto;&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>